<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <title>Carrinho</title>
        <link rel="stylesheet" th:href="@{/css/index.css}" />
    </head>
    <body>
        <header class="header-container">
            <div class="header-content">
                <a href="/">
                    <div class="store-logo">
                        <div class="store-logo-icon">U</div>
                        <span class="store-name">UniWare</span>
                    </div>
                </a>

                <div class="search-container">
                    <form action="/products" method="get">
                        <input
                            type="text"
                            class="search-input"
                            name="search"
                            placeholder="Procure por produtos..."
                        />
                        <button class="search-button" type="submit">üîç</button>
                    </form>
                </div>

                <div class="header-actions">
                    <div class="auth-links">
                        <div th:if="${session.loggedUser != null}">
                            <span
                                >Ol√°,
                                <span
                                    th:text="${session.loggedUser.name}"
                                ></span
                            ></span>
                            <a href="/logout" class="auth-link">Logout</a>
                            <span th:if="${session.loggedUser.role == 'ADMIN'}">
                                |
                                <a href="/admin" class="auth-link"
                                    >√Årea Adminstrador</a
                                >
                            </span>
                            <span th:if="${session.loggedUser.role != NULL}">
                                |
                                <a href="/userProfile" class="auth-link"
                                    >Minha Conta</a
                                >
                            </span>
                        </div>
                        <div th:unless="${session.loggedUser != null}">
                            <a href="/login" class="auth-link">Login</a>
                            <a href="/register" class="auth-link register-link"
                                >Registrar</a
                            >
                        </div>
                    </div>
                    <div class="cart-container">
                        <a href="/cart" class="cart-icon">üõí</a>
                        <span
                            class="cart-count"
                            th:text="${session.cartItemCount != null ? session.cartItemCount : 0}"
                        >
                        </span>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-container">
            <h1 class="page-title">Meu Carrinho</h1>

            <div class="cart-section">
                <div th:if="${#lists.isEmpty(cartItems)}" class="empty-cart">
                    <p>Seu carrinho est√° vazio.</p>
                </div>

                <div th:unless="${#lists.isEmpty(cartItems)}">
                    <table class="cart-table">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Pre√ßo Unit.</th>
                                <th>Quantidade</th>
                                <th>Subtotal</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="item : ${cartItems}">
                                <td
                                    class="product-name"
                                    th:text="${item.product.name}"
                                >
                                    Nome
                                </td>
                                <td
                                    class="product-price"
                                    th:text="${'R$ ' + #numbers.formatDecimal(item.product.price, 1, 2)}"
                                >
                                    0.00
                                </td>
                                <td>
                                    <form
                                        th:action="@{/updateCart/{id}(id=${item.product.id})}"
                                        method="post"
                                        style="display: inline"
                                    >
                                        <input
                                            type="number"
                                            name="quantity"
                                            th:value="${item.quantity}"
                                            min="1"
                                            max="999"
                                            style="width: 60px"
                                        />
                                        <button
                                            type="submit"
                                            class="update-btn"
                                        >
                                            Atualizar
                                        </button>
                                    </form>
                                </td>
                                <td
                                    class="subtotal"
                                    th:text="${'R$ ' + #numbers.formatDecimal(item.subtotal, 1, 2)}"
                                >
                                    0.00
                                </td>
                                <td>
                                    <form
                                        th:action="@{/removeFromCart/{id}(id=${item.product.id})}"
                                        method="post"
                                        style="display: inline"
                                    >
                                        <button
                                            type="submit"
                                            class="remove-btn"
                                            onclick="return confirm('Remover item?')"
                                        >
                                            Remover
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="cart-total">
                        <h3>
                            Total:
                            <span
                                th:text="${'R$ ' + #numbers.formatDecimal(totalPrice, 1, 2)}"
                                >R$ 0,00</span
                            >
                        </h3>
                    </div>

                    <div class="cart-actions">
                        <a href="/products?search=" class="continue-btn">
                            ‚Üê Continuar comprando
                        </a>

                        <a
                            th:href="@{/checkout}"
                            class="buy-btn"
                            style="text-decoration: none"
                        >
                            Prosseguir para pagamento ‚ûî
                        </a>
                    </div>
                </div>

                <div
                    th:if="${#lists.isEmpty(cartItems)}"
                    class="cart-actions"
                    style="justify-content: center"
                >
                    <a href="/products" class="continue-btn">
                        ‚Üê Voltar √†s compras
                    </a>
                </div>
            </div>
        </div>

        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-bottom">
                    ¬© 2025 Loja Online. Todos os direitos reservados.
                </div>
            </div>
        </div>
    </body>
</html>
